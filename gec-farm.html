<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta2/css/all.min.css" integrity="sha512-YWzhKL2whUzgiheMoBFwW8CKV4qpHQAEuvilg9FAn5VJUDwKZZxkJNuGM4XkWuk94WCrrwslk8yWNGmY1EduTA==" crossorigin="anonymous" referrerpolicy="no-referrer"
    />
    <link href="./assets/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.14.0-beta2/css/bootstrap-select.min.css" integrity="sha512-mR/b5Y7FRsKqrYZou7uysnOdCIJib/7r5QeJMFvLNHNhtye3xJp1TdJVPLtetkukFn227nKpXD9OjUc09lx97Q==" crossorigin="anonymous"
        referrerpolicy="no-referrer" />
    <link rel="shortcut icon" href="./assets/images/garbi_favicon.png" type="image/x-icon">
    <link href="./assets/css/style.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/big-integer/1.6.48/BigInteger.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="./assets/js/web3.min.js"></script>
    <script src="./assets/js/trustwallet.js"></script>
    <script src="./js/contract/arbitrum/abi.js"></script>
    <script src="./js/contract/arbitrum/config.js"></script>
    <script src="./js/data/store.js"></script>
    <script src="./js/contract/arbitrum/core.js"></script>
    <script src="./js/contract/arbitrum/base.contract.js"></script>
    <script src="./js/contract/arbitrum/data.js"></script>
    <script src="./js/contract/arbitrum/network.js"></script>
    <script src="./js/contract/arbitrum/base.erc20.token.js"></script>
    <script src="./js/contract/arbitrum/garbi.farm.contract.js"></script>
    <script src="./js/contract/arbitrum/garbi.farm.contract.v2.js"></script>

    <title>GEC Vault - Garbi Protocol</title>
    <style id="svelte-166mr51-style">
        ul.svelte-166mr51 {
            display: flex;
            flex-flow: column nowrap;
            position: fixed;
            font-size: 16px;
            padding: 0 0.75em;
            margin: 0;
            list-style-type: none;
            width: 20em;
            bottom: 0;
            right: 0;
            font-family: 'Helvetica Neue';
            max-height: 100vh;
            overflow-y: scroll;
            overflow-x: hidden;
            color: #4a4a4a;
            background: transparent;
            scrollbar-width: none;
            box-sizing: border-box;
            height: 100vh;
            pointer-events: none;
            z-index: 99999999
        }
        
        @media only screen and (max-width: 450px) {
            ul.svelte-166mr51 {
                width: 100%
            }
        }
        
        .bn-notify-custom.bn-notify-dark-mode {
            background: #283944;
            color: #ffffff;
            background: rgba(40, 57, 68, 0.9)
        }
        
        .bn-notify-clickable:hover {
            cursor: pointer
        }
        
        .svelte-166mr51::-webkit-scrollbar {
            display: none
        }
        
        li.svelte-166mr51 {
            position: relative;
            display: flex;
            padding: 0.75em;
            font-size: 0.889em;
            font-family: inherit;
            border-radius: 10px;
            background: #ffffff;
            box-shadow: 0px 2px 10px rgba(0, 0, 0, 0.1);
            color: inherit;
            transition: background 300ms ease-in-out, color 300ms ease-in-out;
            pointer-events: all;
            background: #ffffff;
            backdrop-filter: blur(5px);
            background: rgba(255, 255, 255, 0.9)
        }
        
        div.svelte-166mr51 {
            position: absolute;
            top: 0.75em;
            right: 0.75em;
            font-size: inherit;
            font-family: inherit
        }
    </style>
    <style id="svelte-7rn0pv-style">
        div.svelte-7rn0pv {
            height: 100%;
            font-size: inherit;
            font-family: inherit;
            width: 1.5em
        }
    </style>
    <style id="svelte-5f7pqk-style">
        div.svelte-5f7pqk {
            display: flex;
            flex-flow: column nowrap;
            justify-content: center;
            font-size: inherit;
            font-family: inherit;
            margin-left: 0.75em;
            width: 90%
        }
        
        p.svelte-5f7pqk {
            display: flex;
            align-items: center;
            margin: 0.5em 0 0 0;
            opacity: 0.7;
            font-size: 0.889em;
            line-height: 1.15;
            font-family: inherit
        }
        
        span.svelte-5f7pqk {
            font-family: inherit;
            display: flex;
            align-items: center
        }
    </style>
    <style id="svelte-12gqi36-style">
        p.svelte-12gqi36 {
            margin: 0;
            font-family: inherit;
            font-size: inherit
        }
    </style>
    <style id="svelte-1ociadw-style">
        svg.svelte-1ociadw {
            margin: 0 0.25em 0 0.5em
        }
    </style>
</head>

<body>
    <div class="wrapper">
        <header class="header" id="header">
            <div class="alert-banner" style="background: rgb(45, 66, 252)">
                <div class="message">Please note that Garbi Protocol is currently only supported on the Arbitrum One network. To use Garbi Protocol, switch to a network that supports it.</div>
            </div>
            <nav class="navbar navbar-expand-lg">
                <div class="container container-1">
                    <div class="row flex-grow-1 align-items-center">
                        <div class="col-6 col-lg-2">
                            <div class="d-flex align-items-center">
                                <button class="navbar-toggler mr-3" type="button" data-bs-toggle="collapse" data-bs-target="#navbar-header">
                                        <i class="fas fa-bars"></i>
                                    </button>
                                <div class="logo" onclick="window.location='index.html'">
                                    <img src="./assets/images/garbi.png" />
                                </div>
                            </div>
                        </div>
                        <div class="col-6 col-lg-2 order-lg-3">
                            <div class="d-flex align-items-center justify-content-end">
                                <span class="wrap-user-acct">0x000</span>
                                <a href="#" class="header__btn-connect btn-connect-wallet wrap-btn-connect">Connect your wallet</a>
                                <!-- <span class="dropMenu">
                                        <button type="button" class="header__btn-swap ms-3 ctmenu-item"><i class="fas fa-ellipsis-h"></i></button>
                                        <div class="ctmenu-sub  swap-box">
                                            <a class="f-roboto f-400" href="dashboard.html">Dashboard</a>
                                        </div>
                                    </span> -->
                            </div>
                        </div>
                        <div class="col-lg-8">
                            <div class="collapse navbar-collapse" id="navbar-header">
                                <ul class="navbar-nav menu-header-swap mx-auto mb-2 mb-lg-0 align-items-lg-center">
                                    <li class="nav-item">
                                        <a class="nav-link" href="swap.html">Swap</a>
                                    </li>
                                    <li class="nav-item dropdown">
                                        <a class="nav-link dropdown-toggle" href="#" id="earnDropdownMore" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                                    Earn 
                                                </a>
                                        <ul class="dropdown-menu" aria-labelledby="earnDropdownMore">
                                            <li>
                                                <a class="dropdown-item" href="nft-lp-earn.html">NFT-LP Earn</a>
                                            </li>
                                            <li>
                                                <a class="dropdown-item" href="earn.html">Classic Earn</a>
                                            </li>
                                        </ul>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="equity-cert-exchange.html">GEC Exchange</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="vest.html">Vest veGRB to GRB</a>
                                    </li>
                                    <li class="nav-item dropdown">
                                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMore" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                                GRB-WETH Liquidity
                                              </a>
                                        <ul class="dropdown-menu" aria-labelledby="navbarDropdownMore">
                                            <li>
                                                <a class="dropdown-item" href="https://app.uniswap.org/#/add/0x5Fd71280b6385157b291b9962f22153FC9E79000/ETH/3000?minPrice=0.0001&maxPrice=0.001" target="_blank">Uniswap V3</a>
                                            </li>
                                            <li>
                                                <a class="dropdown-item" href="deposit.html">GarbiSwap</a>
                                            </li>
                                        </ul>
                                    </li>

                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </nav>
        </header>
        <main class="page__swap page-earn">
            <section class="container">
                <div class="row">
                    <div class="col-lg-6">
                        <article class="swap__main garbi__box-1 p-3 mb-3">
                            <div class="d-flex align-items-center justify-content-between mb-14">
                                <div class="f-700">
                                    <span>GEC Vault</span>
                                </div>
                            </div>

                            <ul>
                                <li style="list-style-type: none; margin-left: -30px;">
                                    <p> Stake GEC to earn veGRB.</p>
                                    <label for="currency_0" style="display:block;">
                                        <span class="currency-laybal"> 
                                            <span class="token-name"><img src="./assets/images/gec-logo.png" style="margin-left: 0;" class="token-icon">GEC</span>
                                            <button class="maxBalanceCoin max-want-bal">Balance: <span class="u-want-bal">Loading</span></button>
                                        </span>
                                    </label>
                                    <div class="addLp__form_input mb-2">
                                        <input autofocus type="" class="swap__form-input" name="deposit_amt" value="" placeholder="0.0">
                                    </div>
                                </li>
                                <li style="list-style-type: none; margin-left: -30px;">
                                    <button type="button" class="header__btn-connect text-center mt-3  btn-approve" style="display: none">Approve GEC</button>
                                    <button type="button" class="header__btn-connect text-center mt-3 btn-farm btn-deposit">Deposit</button>

                                </li>
                            </ul>
                        </article>
                        <article class="garbi__box-1 p-3 mb-3 mt-3">
                            <p class="f-700">Vault's stats</p>

                            <div>Apr: <span class="apy">-</span></div>
                            <div>Total: <span class="tvl">-</span></div>
                        </article>
                    </div>
                    <div class="col-lg-6">
                        <article class="swap__main garbi__box-1 p-3 mb-3">
                            <div class="d-flex align-items-center justify-content-between mb-14">
                                <div class="f-700">
                                    <span>Your account</span>
                                </div>
                            </div>
                            <ul>
                                <li style="list-style-type: none; margin-left: -30px;" class="mt-3">
                                    <p style="margin-bottom: 0;">Staked: <span class="u-share">Loading</span></p>
                                    <p>Earned:
                                        <span class="u-pending-grb">Loading</span>
                                        <span>veGRB <button type="button" class="header__btn-connect mt-3 text-center btn-harvest">Harvest</button></span>

                                    </p>
                                    <label for="currency_0" style="display:block;">
                                        <span class="currency-laybal"> 
                                            <span class="token-name"><img src="./assets/images/gec-logo.png" style="margin-left: 0;" class="token-icon"> GEC</span>
                                            <button class="maxBalanceCoin max-share">Balance: <span class="u-share">Loading</span> </button>
                                            
                                        </span>
                                    </label>
                                    <div class="addLp__form_input mb-2">
                                        <input type="" class="swap__form-input" name="withdraw_amt" value="" placeholder="0.0">
                                    </div>
                                </li>
                            </ul>
                            <div>
                                <button type="button" class="header__btn-connect mt-2 text-center btn-withdraw btn-claim">Withdraw your GEC</button>
                            </div>
                        </article>
                    </div>
                </div>


            </section>
        </main>

        <footer class="footer">
            <nav class="navbar navbar-expand-lg">
                <div class="container container-1">
                    <div class="row flex-grow-1 align-items-center">
                        <div class="col-lg-4">
                            <div class="d-flex align-items-center justify-content-between">
                                <div>Â© 2023 Garbi Protocol</div>
                                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar-footer">
                                        <i class="fas fa-bars"></i>
                                    </button>
                            </div>
                        </div>
                        <div class="col-lg-8">
                            <div class="collapse navbar-collapse" id="navbar-footer">
                                <ul class="navbar-nav menu-footer ms-auto mb-2 mb-lg-0">
                                    <li class="nav-item">
                                        <a class="nav-link" href="risks.html" class="">Risks</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" target="_blank" href="https://garbi-protocol.gitbook.io/docs/">Docs</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" target="_blank" href="https://twitter.com/garbi_protocol/" rel="noopener noreferrer">#Twitter</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" target="_blank" href="https://t.me/garbiprotocol" rel="noopener noreferrer">@Telegram</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" target="_blank" href="https://github.com/garbiprotocol">git@</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="v1/index.html">V1</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="no-loss-lottery.html">Lottery</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="#">Version 2.0.5</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </nav>
        </footer>
    </div>
    <ul id="confirm-popup" class="bn-notify-custom bn-notify-notifications svelte-166mr51" style="display:none;top: 0; justify-content: unset;">
        <li style="margin: 0.75rem 0px 0px;" class="bn-notify-custom bn-notify-notification svelte-166mr51">
            <div class="bn-notify-custom bn-notify-notification-info svelte-5f7pqk">
                <p class="bn-notify-custom bn-notify-notification-info-message svelte-12gqi36">Your <a href="" target="_blank" class="transaction-hash">transaction</a> is sent to the Blockchain.</p>
            </div>
            <div class="bn-notify-custom bn-notify-notification-close svelte-166mr51" onclick="$('#confirm-popup').hide()">
                <div class="bn-notify-custom bn-notify-notification-close-icon svelte-r8gx3p">
                    <svg height="8" viewBox="0 0 12 12" width="8" xmlns="http://www.w3.org/2000/svg">
                        <g fill="none" stroke="#9B9B9B" stroke-linecap="square" stroke-width="2" transform="translate(2 2)" style="transition: stroke 150ms ease-in-out 0s;">
                        <path d="m.1.1 7.82304289 7.82304289"></path>
                        <path d="m.1.1 7.82304289 7.82304289" transform="matrix(-1 0 0 1 8 0)"></path>
                        </g>
                        </svg>
                </div>
            </div>
        </li>
    </ul>
    <ul id="success-confirm-popup" class="bn-notify-custom bn-notify-notifications svelte-166mr51" style="display:none; top: 0; justify-content: unset;">
        <li style="margin: 0.75rem 0px 0px;" class="bn-notify-custom bn-notify-notification svelte-166mr51">
            <div class="bn-notify-custom bn-notify-notification-info svelte-5f7pqk">
                <p class="bn-notify-custom bn-notify-notification-info-message svelte-12gqi36">Your <a href="" target="_blank" class="transaction-hash">transaction</a> is confirmed.</p>
            </div>
            <div class="bn-notify-custom bn-notify-notification-close svelte-166mr51" onclick="$('#success-confirm-popup').hide()">
                <div class="bn-notify-custom bn-notify-notification-close-icon svelte-r8gx3p">
                    <svg height="8" viewBox="0 0 12 12" width="8" xmlns="http://www.w3.org/2000/svg">
                        <g fill="none" stroke="#9B9B9B" stroke-linecap="square" stroke-width="2" transform="translate(2 2)" style="transition: stroke 150ms ease-in-out 0s;">
                        <path d="m.1.1 7.82304289 7.82304289"></path>
                        <path d="m.1.1 7.82304289 7.82304289" transform="matrix(-1 0 0 1 8 0)"></path>
                        </g>
                        </svg>
                </div>
            </div>
        </li>
    </ul>
    <script src="./assets/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.14.0-beta2/js/bootstrap-select.min.js" integrity="sha512-FHZVRMUW9FsXobt+ONiix6Z0tIkxvQfxtCSirkKc5Sb4TKHmqq1dZa8DphF0XqKb3ldLu/wgMa8mT6uXiLlRlw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="./assets/js/custom.js"></script>
    <script src="./assets/js/custom.menu.js"></script>

</body>
<script>
    var abiHelper = new $.ABI();
    var coreHelper = new $.Core();
    var configHelper = new $.CONFIG();
    var contractBaseHelper = new $.CONTRACTBASE();
    var erc20Helper = new $.BASE_ERC20_TOKEN();
    var garbiFarm = new $.GARBI_FARM_V2();
    var networkHelper = new $.GARBI_NETWORK();

    var chainId = 42161;
    var pid = 12;
    $('.alert-banner').hide();
    if (typeof window.ethereum !== 'undefined') {
        const web3 = new Web3(window.ethereum);
        window.ethereum.enable();
        web3.eth.getChainId()
            .then(chainId => {
                if (chainId !== 42161) {
                    $('.alert-banner').show();
                } else {
                    $('.alert-banner').hide();
                }
            })
            .catch(error => {
                console.error(error);
            });
    } else {
        console.log("Metamask not found");
    }
    $(document).ready(function() {
        abiHelper.init({});
        coreHelper.init({});
        configHelper.init({});
        contractBaseHelper.init({
            chainId: chainId
        });
        let erc20Abi = abiHelper.getERC20ABI();
        let tokenAddress = configHelper.getFarmContractByPid(chainId, pid).want;
        erc20Helper.init({
            chainId: chainId,
            tokenAddress: tokenAddress,
            tokenAbi: erc20Abi,
        })

        garbiFarm.init({
            chainId: chainId,
            pid: pid,
            tokenAction: erc20Helper,
        });
        run();
    });

    async function run() {
        let userAddr = coreHelper.getUserAccount();
        let userData = await garbiFarm.GetDataUser(userAddr);
        $('.u-want-bal').html(`${ coreHelper.numberWithCommas(userData.userWantBal, 6) }`);
        $('.u-share').html(`${ coreHelper.numberWithCommas(userData.userWantShare, 6) }`);
        $('.u-pending-grb').html(`${ coreHelper.numberWithCommas(userData.userGRBPending, 6) }`);
        $(`.apy`).html(`${ coreHelper.numberWithCommas(userData.apy, 2) }%`);
        $(`.tvl`).html(`${ coreHelper.formatBalance(userData.tvl, 2) }`);

        setInterval(async function() {
            let userAddr = coreHelper.getUserAccount();
            let userData = await garbiFarm.GetDataUser(userAddr);
            $('.u-want-bal').html(`${ coreHelper.numberWithCommas(userData.userWantBal, 6) }`);
            $('.u-share').html(`${ coreHelper.numberWithCommas(userData.userWantShare, 6) }`);
            $('.u-pending-grb').html(`${ coreHelper.numberWithCommas(userData.userGRBPending, 6) }`);
            $(`.apy`).html(`${ coreHelper.numberWithCommas(userData.apy, 2) }%`);
            $(`.tvl`).html(`${ coreHelper.formatBalance(userData.tvl, 2) }`);
        }, 15000);

        setInterval(async function() {
            let userInputVal = $('input[name=deposit_amt]').val();
            if (userInputVal > userData.userWantBal) {
                $('.btn-deposit').addClass("disable");
            } else {
                $('.btn-deposit').removeClass("disable");
            }
        }, 1000);


        $(`.max-want-bal`).on("click", () => {
            let userBalance = $('.u-want-bal').text();
            $('input[name=deposit_amt]').val(userBalance);
        });
        $(`.max-share`).on("click", () => {
            let userMaxShare = $('.currency-laybal .u-share').text();
            $('input[name=withdraw_amt]').val(userMaxShare);
        });

        $('.btn-deposit').click(async function() {
            let curChainId = await networkHelper.GetChainIdToMain();
            if (curChainId != chainId) {
                networkHelper.SwichNetworkByChainId(chainId);
                return;
            }
            let userAddr = coreHelper.getUserAccount();
            let userInputVal = $('input[name=deposit_amt]').val();
            let checkAllowce = await garbiFarm.GetAllowanceWantToFarmContract(userAddr);
            let data = await garbiFarm.GetTokenWantOfFarmContractByPid();
            let wantDecimal = data.wantDecimal;
            if (checkAllowce / wantDecimal < userInputVal) {
                $('.btn-approve').show();
            } else {
                garbiFarm.Deposit(userAddr, coreHelper.toBN(userInputVal, wantDecimal));
            }
        });
        $('.btn-approve').click(async function() {
            let curChainId = await networkHelper.GetChainIdToMain();
            if (curChainId != chainId) {
                networkHelper.SwichNetworkByChainId(chainId);
                return;
            }
            let userAddr = coreHelper.getUserAccount();
            garbiFarm.ApproveWantToFarmContract(userAddr);
        });
        $('.btn-harvest').click(async function() {
            let curChainId = await networkHelper.GetChainIdToMain();
            if (curChainId != chainId) {
                networkHelper.SwichNetworkByChainId(chainId);
                return;
            }
            let userAddr = coreHelper.getUserAccount();
            garbiFarm.Harvest(userAddr);
        });
        $('.btn-withdraw').click(async function() {
            let curChainId = await networkHelper.GetChainIdToMain();
            if (curChainId != chainId) {
                networkHelper.SwichNetworkByChainId(chainId);
                return;
            }
            let userAddr = coreHelper.getUserAccount();
            let userWantWithdraw = $('input[name=withdraw_amt]').val();
            let data = await garbiFarm.GetTokenWantOfFarmContractByPid();
            let wantDecimal = data.wantDecimal;
            garbiFarm.Withdraw(userAddr, coreHelper.toBN(userInputVal, wantDecimal));
        });
    }
</script>

</html>